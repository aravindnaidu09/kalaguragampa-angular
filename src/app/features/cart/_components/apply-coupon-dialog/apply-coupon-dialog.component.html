<div class="coupon-dialog" (keyup.escape)="close()">
  <div class="dlg-header">
    <h3>Apply Coupon</h3>
    <button class="icon-btn" type="button" aria-label="Close dialog" (click)="close()">×</button>
  </div>

  <div class="apply-box">
    <input [formControl]="code" placeholder="Enter coupon code (e.g. SAVE10)" />
    <button class="btn-apply" (click)="apply()" [disabled]="(applying$ | async) === true">
      {{ (applying$ | async) ? 'Applying…' : 'Apply' }}
    </button>
  </div>

  <div class="error" *ngIf="(error$ | async) as err">{{ err }}</div>

  <div class="divider"></div>

  <div class="list-head">
    <span>Available Coupons</span>
    <small *ngIf="(loading$ | async)">loading…</small>
  </div>

  <div class="coupon-list" *ngIf="(available$ | async) as coupons">
    <ng-container *ngIf="coupons.length; else empty">
      <div class="coupon-card" *ngFor="let c of coupons; trackBy: trackById">
        <div class="left">
          <div class="code">{{ c.code }}</div>
          <div class="desc">{{ c.discount_preview || c.description }}</div>
          <div class="meta">
            <span *ngIf="c.coupon_type">{{ c.coupon_type | uppercase }}</span>
            <span *ngIf="c.min_order_value">Min Order Value: ₹{{ c.min_order_value }}</span>
            <span *ngIf="c.max_discount">Max Off: ₹{{ c.max_discount }}</span>
          </div>
          <div class="reason ineligible" *ngIf="c.ineligible_reason">{{ c.ineligible_reason }}</div>
        </div>
        <div class="right">
          <button class="btn-outline" (click)="pick(c)" [disabled]="!!c.ineligible_reason">Use</button>
        </div>
      </div>
    </ng-container>
    <ng-template #empty>
      <div class="empty">No coupons found for your cart.</div>
    </ng-template>
  </div>
</div>
