<div class="product-card">
  <!-- ‚ù§Ô∏è Wishlist Icon (Material Icon; single element) -->
  <button class="wishlist-icon heart-btn" #wishIcon type="button" (click)="onWishlistClick()"
    [disabled]="isWishlistUpdating" [class.active]="isWishlistedSignal()" aria-label="Toggle wishlist"
    [attr.aria-pressed]="isWishlistedSignal()">
    <!-- One icon that toggles between outline/fill glyphs -->
    <mat-icon class="heart-icon">
      {{ isWishlistedSignal() ? 'favorite' : 'favorite_border' }}
    </mat-icon>

    <!-- Loader (optional) -->
    <div class="spinner mini" *ngIf="isUpdatingWishlist"></div>

    <!-- Firecracker particles -->
    <div class="burst" *ngIf="showBurst">
      <i class="spark" *ngFor="let p of particles" [style.--angle]="p.angle" [style.--dist]="p.dist"
        [style.--delay.ms]="p.delay" [style.--hue]="p.hue"></i>
    </div>
  </button>

  <!-- üì¶ Product Image -->
  <div class="product-image" (click)="navigateViewProduct(product.name!, product.id!)">
    <img [src]="getImagePath(product.images?.[0]?.image)" alt="{{ product.name }}" loading="lazy"
      (error)="onImageError($event)" />
  </div>

  <!-- üìù Product Details -->
  <div class="product-details">
    <div class="product-header" (click)="navigateViewProduct(product.name!, product.id!)">
      <h4 [title]="product.name">{{ product.name }}</h4>
    </div>

    <div class="product-price">
      {{ currencyService.format(product?.price, currencyService.currency()) }}
    </div>

    <div class="rating-cart-wrapper">
      <div class="product-rating">
        ({{ product.rating }}) ‚≠ê | ({{product.reviewsCount}})
      </div>

      <!-- üõí Add to Cart (loader controlled by parent) -->
      <div class="add-to-cart-wrapper" [class.loading]="isUpdatingCart" (click)="addToCart(product)">
        <ng-container *ngIf="!isUpdatingCart; else cartLoader">
          <span class="add-to-cart-icon" role="button" tabindex="0" aria-label="Add to Cart"
            [attr.aria-busy]="isUpdatingCart">üõí</span>
        </ng-container>
        <ng-template #cartLoader>
          <div class="spinner mini"></div>
        </ng-template>
        <div class="tooltip">Add to Cart</div>
      </div>
    </div>
  </div>

</div>
